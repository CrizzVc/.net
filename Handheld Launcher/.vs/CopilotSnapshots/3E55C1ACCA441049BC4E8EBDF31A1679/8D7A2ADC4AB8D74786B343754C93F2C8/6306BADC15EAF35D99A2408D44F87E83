<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Handheld_Launcher.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Handheld_Launcher"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Handheld Launcher">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid"
          KeyDown="RootGrid_KeyDown"
          IsTabStop="True">

        <Grid.Resources>
            <local:BoolToWidthConverter x:Key="BoolToWidthConverter" />
            <!-- Converter para visibilidad basada en null (añadido) -->
            <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
            <local:NullToVisibilityConverter x:Key="NullToVisibilityInverted" Invert="True" />
        </Grid.Resources>

        <!-- COLUMNAS -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="80"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- FILAS -->
        <Grid.RowDefinitions>
            <RowDefinition Height="9*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="50" />
        </Grid.RowDefinitions>

        <!-- SIDEBAR -->
        <Grid x:Name="LeftSidebar"
              Grid.Column="0"
              Grid.RowSpan="3"
              Background="#16171b">

            <StackPanel VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Spacing="25">

                <Button Click="Home_Click" Width="50" Height="50" CornerRadius="10">
                    <FontIcon Glyph="&#xE80F;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                </Button>

                <Button Click="Library_Click" Width="50" Height="50" CornerRadius="10">
                    <FontIcon Glyph="&#xe74c;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                </Button>

                <Button Click="AddGame_Click" Width="50" Height="50" CornerRadius="10">
                    <FontIcon Glyph="&#xe948;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                </Button>

                <Button Width="50" Height="50" CornerRadius="10">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="Color sólido" Click="Solid_Click"/>
                            <MenuFlyoutItem Text="Degradado" Click="Gradient_Click"/>
                            <MenuFlyoutItem Text="Imagen" Click="Image_Click"/>
                        </MenuFlyout>
                    </Button.Flyout>
                    <FontIcon Glyph="&#xe713;" FontFamily="Segoe MDL2 Assets" FontSize="24"/>
                </Button>

            </StackPanel>

        </Grid>

        <!-- BACKGROUND: dos imágenes para crossfade -->
        <Image x:Name="BackgroundImageA"
               Grid.Column="1"
               Stretch="UniformToFill"
               Grid.RowSpan="3"
               Opacity="1"/>

        <Image x:Name="BackgroundImageB"
               Grid.Column="1"
               Stretch="UniformToFill"
               Grid.RowSpan="3"
               Opacity="0"/>

        <!-- GRADIENT OVERLAY (más intenso para mayor presencia visual) -->
        <Grid Grid.Column="1" Grid.RowSpan="3">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <!-- Stops más oscuros y con mayor opacidad para mayor intensidad -->
                    <GradientStop Color="#00000000" Offset="0"/>
                    <GradientStop Color="#22000000" Offset="0.35"/>
                    <GradientStop Color="#66000000" Offset="0.65"/>
                    <GradientStop Color="#CC000000" Offset="1"/>
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <!-- SPLASH / STARTUP — estilo minimal, centrado tipo PS5 -->
        <Grid x:Name="SplashOverlay"
              Grid.Column="1"
              Grid.RowSpan="3"
              Background="Transparent"
              Visibility="Visible"
              IsHitTestVisible="False">
            <!-- se muestra el mismo fondo (las imágenes A/B están debajo) -->
            <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="14" Opacity="1">
                    <!-- Minimal logo / marca -->
                    <TextBlock Text="HANDHELD"
                               FontSize="42"
                               FontWeight="Bold"
                               Foreground="White"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Launcher" FontSize="20" Foreground="#DDFFFFFF" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- STATUS (red + bateria + reloj) -->
        <StackPanel Grid.Column="1" Grid.Row="0"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,30,40,0"
                    Spacing="12"
                    x:Name="StatusPanel">

            <!-- Network: icon + (opcional) texto -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="6">
                <FontIcon x:Name="NetworkIcon"
                          FontFamily="Segoe MDL2 Assets"
                          Glyph="&#xE701;"
                          FontSize="20"
                          Foreground="LightGray"
                          VerticalAlignment="Center"/>
                <!-- opcional etiqueta corta -->
                <TextBlock x:Name="NetworkText"
                           Text=""
                           Foreground="White"
                           FontSize="14"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Battery: icon + porcentaje -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="6">
                <FontIcon x:Name="BatteryIcon"
                          FontFamily="Segoe MDL2 Assets"
                          Glyph="&#xEB10;"
                          FontSize="20"
                          Foreground="LightGray"
                          VerticalAlignment="Center"/>
                <TextBlock x:Name="BatteryPercent"
                           Text=""
                           Foreground="White"
                           FontSize="14"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Reloj -->
            <TextBlock x:Name="TimeTextBlock"
                       FontSize="26"
                       FontWeight="SemiBold"
                       Foreground="White"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- CONTENEDOR DE VISTAS -->
        <Grid Grid.Column="1" Grid.Row="1">

            <!-- HOME VIEW -->
            <StackPanel x:Name="HomeView" Padding="40,0">

                <StackPanel Orientation="Horizontal" Spacing="20" Margin="0,0,0,20">
                    <TextBlock Text="MIS JUEGOS"
                               FontWeight="Bold"
                               FontSize="28"
                               Foreground="White"/>
                </StackPanel>

                <ScrollViewer x:Name="CarouselScrollViewer"
                              HorizontalScrollMode="Enabled"
                              HorizontalScrollBarVisibility="Hidden"
                              VerticalScrollMode="Disabled">

                    <GridView x:Name="CarouselGrid"
                              ItemsSource="{x:Bind OtherGames, Mode=OneWay}"
                              IsItemClickEnabled="True"
                              ItemClick="CarouselGrid_ItemClick"
                              SelectionMode="Single">

                        <GridView.ItemContainerStyle>
                            <Style TargetType="GridViewItem">
                                <!-- Desactivar el foco visual del sistema (quita el borde azul) -->
                                <Setter Property="UIElement.UseSystemFocusVisuals" Value="False"/>
                                <!-- Asegurar que no se pinte ningún trazado de foco -->
                                <Setter Property="FrameworkElement.FocusVisualPrimaryBrush" Value="Transparent"/>
                                <Setter Property="FrameworkElement.FocusVisualSecondaryBrush" Value="Transparent"/>
                                <Setter Property="FrameworkElement.FocusVisualPrimaryThickness" Value="0"/>
                                <Setter Property="FrameworkElement.FocusVisualSecondaryThickness" Value="0"/>
                            </Style>
                        </GridView.ItemContainerStyle>

                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>

                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="local:GameItem">
                                <StackPanel Width="{Binding IsLarge, Converter={StaticResource BoolToWidthConverter}}" Margin="14">
                                    <Border Height="260" CornerRadius="12" Background="#222" Width="{Binding IsLarge, Converter={StaticResource BoolToWidthConverter}}">
                                        <Image Source="{x:Bind DisplayImage}" Stretch="UniformToFill"/>
                                    </Border>
                                    <TextBlock Text="{x:Bind Name}" Foreground="White" Margin="0,10,0,0" TextWrapping="Wrap"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridView.ItemTemplate>

                    </GridView>
                </ScrollViewer>

            </StackPanel>

            <!-- LIBRARY VIEW -->
            <Grid x:Name="LibraryView"
                  Visibility="Collapsed"
                  Height="1060"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  Padding="40">

                <Grid.Background>
                    <SolidColorBrush Color="#AA000000" />
                    <!-- negro semi-transparente -->
                </Grid.Background>

                <StackPanel>

                    <TextBlock Text="BIBLIOTECA"
                               FontSize="40"
                               Foreground="White"
                               Margin="0,0,0,30"/>

                    <GridView x:Name="LibraryGrid"
                              ItemsSource="{x:Bind OtherGames, Mode=OneWay}"
                              IsItemClickEnabled="True"
                              ItemClick="LibraryGrid_ItemClick"
                              SelectionMode="Single">

                        <GridView.ItemContainerStyle>
                            <Style TargetType="GridViewItem">
                                <Setter Property="UIElement.UseSystemFocusVisuals" Value="False"/>
                                <Setter Property="FrameworkElement.FocusVisualPrimaryBrush" Value="Transparent"/>
                                <Setter Property="FrameworkElement.FocusVisualSecondaryBrush" Value="Transparent"/>
                                <Setter Property="FrameworkElement.FocusVisualPrimaryThickness" Value="0"/>
                                <Setter Property="FrameworkElement.FocusVisualSecondaryThickness" Value="0"/>
                            </Style>
                        </GridView.ItemContainerStyle>

                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsWrapGrid Orientation="Horizontal"
                                               MaximumRowsOrColumns="6"/>
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>

                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="local:GameItem">
                                <StackPanel Width="200" Margin="12">
                                    <Border Height="260"
                                            CornerRadius="12"
                                            Background="#222">
                                        <Image Source="{x:Bind DisplayImage}"
                                               Stretch="UniformToFill"/>
                                    </Border>
                                    <TextBlock Text="{x:Bind Name}"
                                               Foreground="White"
                                               Margin="0,10,0,0"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridView.ItemTemplate>

                    </GridView>

                </StackPanel>
            </Grid>

            <Grid x:Name="DetailOverlay" Grid.RowSpan="3" Visibility="Collapsed" Background="#FF000000" IsHitTestVisible="False">
                <Image Source="{Binding SelectedGame.BackgroundOrIcon}" Stretch="UniformToFill" Opacity="0.35"/>
                <Rectangle>
                    <Rectangle.Fill>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="#00000000" Offset="0.0"/>
                            <GradientStop Color="#B3000000" Offset="0.6"/>
                        </LinearGradientBrush>
                    </Rectangle.Fill>
                </Rectangle>
                <StackPanel HorizontalAlignment="Left" VerticalAlignment="Center" Margin="80" MaxWidth="900" IsHitTestVisible="True">
                    <!-- Reemplazado el uso de Style.Triggers (no soportado) por binding a Visibility con convertidores -->
                    <Image Source="{Binding SelectedGame.Logo}"
           Stretch="Uniform"
           MaxWidth="300"
           HorizontalAlignment="Left"
           Visibility="{Binding SelectedGame.Logo, Converter={StaticResource NullToVisibilityConverter}}"/>

                    <!-- NOMBRE (solo si no hay logo) -->
                    <TextBlock Text="{Binding SelectedGame.Name}"
                       FontSize="72"
                       FontFamily="ms-appx:///Assets/GoogleSans-Variable.ttf#Google Sans"
                       FontWeight="SemiBold"
                       Foreground="White"
                       TextWrapping="Wrap"
                       MaxWidth="600"
                       Visibility="{Binding SelectedGame.Logo, Converter={StaticResource NullToVisibilityInverted}}">  
                    </TextBlock>

                    <StackPanel Orientation="Horizontal" Spacing="20" Margin="0,24,0,0">
                        <Button Content="▶ PLAY" Click="PlaySelectedGame_Click" Style="{StaticResource AccentButtonStyle}" Width="160" Height="48" />
                        <Button Content="Cerrar" Click="HideDetail_Click" Width="120" Height="48" />
                        <Button Content="⋯" Width="48" Height="48" FontSize="22" Click="OpenGameOptions_Click"/>
                    </StackPanel>
                </StackPanel>
            </Grid>

        </Grid>

    </Grid>
</Window>